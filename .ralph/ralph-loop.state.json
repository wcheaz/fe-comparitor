{
  "active": true,
  "iteration": 4,
  "minIterations": 1,
  "maxIterations": 50,
  "completionPromise": "COMPLETE",
  "tasksMode": true,
  "taskPromise": "READY_FOR_NEXT_TASK",
  "prompt": "# Product Requirements Document\n\n*Generated from OpenSpec artifacts*\n\n## Proposal\n\n# Fire Emblem Unit Comparator Implementation Proposal\n\nThis document outlines the detailed steps to build the Fire Emblem Unit Comparator web application.\n\n## Phase 1: Project Initialization & Configuration\n\n1.  **Initialize Next.js Project**\n    -   Run `npx create-next-app@latest . --typescript --tailwind --eslint` (if not already initialized).\n    -   Ensure `tsconfig.json` is configured with strict mode.\n    -   Review `tailwind.config.ts` for theme customization (Fire Emblem inspired colors).\n    -   Install additional dependencies: `clsx`, `tailwind-merge` (for utility classes), `recharts` or `chart.js` (for graphs).\n\n2.  **Directory Structure Setup**\n    -   Create `components/ui` for reusable UI components.\n    -   Create `components/features` for domain-specific components (UnitCard, StatTable).\n    -   Create `lib` for utility functions (stat calculations).\n    -   Create `types` for TypeScript interfaces.\n    -   Ensure `data` directory is populated with game JSONs.\n\n## Phase 2: Data Architecture & Type Definitions\n\n3.  **Define Core Interfaces (`types/unit.ts`)**\n    -   Create `UnitStats` interface with all fields optional:\n        ```typescript\n        interface UnitStats {\n            hp?: number;\n            str?: number;\n            mag?: number;\n            skl?: number; // Skill (GBA/Tellius)\n            dex?: number; // Dexterity (3H/Engage)\n            spd?: number;\n            lck?: number;\n            def?: number;\n            res?: number;\n            con?: number; // Constitution (GBA)\n            bld?: number; // Build (Engage)\n            mov?: number;\n            cha?: number; // Charm (3H)\n            [key: string]: number | undefined; // Flexible for future games\n        }\n        ```\n    -   Create `PromotionOption` interface for branching paths:\n        ```typescript\n        interface PromotionOption {\n            class: string;\n            promoGains: UnitStats;\n            // potential new growths?\n        }\n        ```\n    -   Create `Unit` interface:\n        ```typescript\n        interface Unit {\n          id: string;\n          name: string;\n          game: string;\n          class: string;\n          joinChapter: string;\n          level: number; // Base level\n          stats: UnitStats; // Base stats (includes HP)\n          growths: UnitStats; // Growth rates\n          maxStats?: UnitStats; // Optional caps\n          skills?: string[];\n\n          // New Advanced Features\n          supports?: string[]; // List of unit IDs or Names this unit supports with\n          reclassOptions?: string[]; // List of classes unit can reclass into\n          promotions?: PromotionOption[]; // Branching promotion paths\n          affinity?: string; // Support affinity (Fire, Thunder, etc.)\n        }\n        ```\n    -   Create `GameData` interface for game-specific metadata (stat labels, max level).\n    -   **Consider separate `ClassData`** if reclassing changes base stats/growths significantly (e.g., Shadow Dragon/Awakening/Fates/Engage style). For now, `reclassOptions` and `promotions` on the unit might suffice for simple display, but full calc needs class data.\n\n4.  **Implement Data Service (`lib/data.ts`)**\n    -   Create function `getAllUnits()`: merging data from all JSON files.\n    -   Create function `getUnitsByGame(game: string)`.\n    -   Create function `getUnitById(id: string)`.\n    -   Implement error handling for missing files or malformed data.\n\n## Phase 3: Core Logic Implementation\n\n5.  **Stat Calculation Utility (`lib/stats.ts`)**\n    -   Implement `calculateAverageStats(unit: Unit, targetLevel: number): UnitStats`.\n        -   Formula: `Base + (Growth * (TargetLevel - BaseLevel) / 100)`.\n        -   Handle capping at max stats if data available.\n        -   Handle negative level differences (if user selects lower level).\n    -   Implement `compareUnits(unitA: Unit, unitB: Unit, level: number)` returning stat differences.\n\n6.  **Data Normalization**\n    -   Create utility to standardize stat keys (e.g., ensure \"Str\" vs \"Strength\" align if needed, or mapping config).\n    -   Handle missing stats (e.g., Magic in games without Magic stat).\n\n## Phase 4: UI Component Development\n\n7.  **Shared UI Components**\n    -   `Button`: standardized styles.\n    -   `Card`: container with consistent padding/shadow.\n    -   `Input/Select`: for unit filtering.\n\n8.  **Feature Components**\n    -   `UnitCard`: Displays unit portrait (placeholder if needed), name, class, join info.\n    -   `StatTable`: Renders table of stats. Needs to handle dynamic keys.\n        -   Columns: Stat Name | Base | Growth | Average (at Level X).\n    -   `GrowthChart`: A radar chart or bar chart comparing growths of selected units.\n    -   `LevelSlider`: Control to dynamically change the level for average stat calculation.\n\n9.  **Comparison View Components**\n    -   `UnitSelector`: Searchable dropdown to add unit to comparison.\n    -   `ComparisonGrid`: Layout for side-by-side unit cards.\n    -   `StatDifferenceHelper`: Visual indicator (green/red) for higher/lower stats.\n\n## Phase 5: Page Implementation\n\n10. **Home Page (`app/page.tsx`)**\n    -   Hero section explaining purpose.\n    -   \"Quick Compare\" feature (select 2 random or popular units).\n    -   Links to specific Game rosters.\n\n11. **Comparator Page (`app/comparator/page.tsx`)**\n    -   State: `selectedUnits` (Array of Units).\n    -   State: `targetLevel` (number).\n    -   Layout:\n        -   Top: Unit Selectors (allow adding up to 4 units).\n        -   Middle: Controls (Level Slider, Toggle Display Mode).\n        -   Bottom: Comparison Grid / Charts.\n\n12. **Unit Detail Page (`app/units/[id]/page.tsx`)**\n    -   Detailed view for a single unit.\n    -   Lore/Description (if available).\n    -   Full growth rates and base stats.\n    -   \"Compare with...\" button.\n\n## Phase 6: Styling & Polish\n\n13. **Theming**\n    -   Implementation of a color scheme fitting Fire Emblem (Blue/Gold/White or game specific).\n    -   Responsive adjustments for mobile (stacking comparison cards).\n\n14. **Optimization**\n    -   `useMemo` for expensive stat calculations.\n    -   Static Generation (SSG) for Unit Detail pages if data is static.\n\n15. **Testing & Validation**\n    -   Verify calculations against known averages (Serenes Forest or similar wiki).\n    -   Test edge cases: Level 1 to Level 20/40 comparisons.\n    -   Ensure missing stats (e.g., Constitution) don't break the UI.\n\n## Phase 7: Deployment\n\n16. **Build & Deploy**\n    -   Run `npm run build` to check for type errors.\n    -   Deploy to Vercel (or preferred host).\n\n## Specifications\n\nproject-structure/spec.md\n## ADDED Requirements\n\n### Requirement: Next.js Boilerplate\nThe system SHALL be initialized as a Next.js application with TypeScript, Tailwind CSS, and ESLint configuration.\n\n#### Scenario: Fresh Install\n- **WHEN** the project is initialized\n- **THEN** it must contain `next.config.mjs` (or .js/.ts)\n- **AND** `package.json` must list `next`, `react`, `react-dom`, `typescript`, `tailwindcss`\n\n### Requirement: Directory Structure\nThe system SHALL follow a feature-based directory structure for Scalability.\n\n#### Scenario: Core Directories\n- **WHEN** the project is set up\n- **THEN** `components/ui` directory must exist\n- **AND** `components/features` directory must exist\n- **AND** `lib` directory must exist\n- **AND** `types` directory must exist\n- **AND** `data` directory must exist\n\n\n\n## Design\n\n# Design: Project Initialization\n\n## Context\nWe are building the \"Fire Emblem Unit Comparator,\" a web application to compare unit statistics across various Fire Emblem games. This change initializes the project, setting up the foundation, data architecture, core logic, and UI.\n\n## Goals / Non-Goals\n- **Goals:**\n    - Initialize a scalable Next.js project structure.\n    - Define flexible TypeScript interfaces to handle data from multiple FE games (different stats, growth systems).\n    - Implement core logic for stat prediction (averages based on growths).\n    - Create a user-friendly UI for selecting and comparing units.\n- **Non-Goals:**\n    - distinct Backend/Database (we will use static JSON files for now).\n    - User Authentication (comparison is stateless/local).\n    - Mobile app (Responsive Web App is the target).\n\n## Decisions\n- **Decision: Next.js + TypeScript + Tailwind CSS**\n    - **Why:** Industry standard for React apps, providing strong type safety (crucial for our complex data schemas) and rapid styling.\n- **Decision: Static JSON Data Source**\n    - **Why:** Game data is static and rarely changes. Avoiding a database reduces complexity and hosting costs.\n    - **Alternatives:** Database (PostgreSQL/MongoDB) - overkill for read-only static data.\n- **Decision: Client-Side Stat Calculation**\n    - **Why:** Users need to interactively change levels and classes. Calculating on the client allows for instant feedback availability without server roundtrips.\n\n## Risks / Trade-offs\n- **Risk:** Large Data Files\n    - **Mitigation:** If `data/` JSONs become too large, we will implement dynamic imports or fetch logic to load only the specific game data needed.\n- **Risk:** Game Logic Variations (e.g., different rounding modes or caps)\n    - **Mitigation:** The `UnitStats` interface is designed to be flexible (`[key: string]: number` index signature). We will start with a generic calculation model and abstract game-specific logic into strategy patterns if variations become too complex.\n\n## Migration Plan\n- N/A - usage of a new project.\n\n## Open Questions\n- Specifics of \"Reclassing\" logic for newer games (Engage/Three Houses) vs older games (GBA). We will start with \"Base Class\" assumptions and expand.",
  "promptTemplate": "openspec/changes/initialize-project/.ralph/prompt-template.md",
  "startedAt": "2026-02-18T21:25:32.937Z",
  "model": "",
  "agent": "opencode"
}