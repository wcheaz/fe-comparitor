{
  "active": true,
  "iteration": 2,
  "minIterations": 1,
  "maxIterations": 50,
  "completionPromise": "COMPLETE",
  "tasksMode": true,
  "taskPromise": "READY_FOR_NEXT_TASK",
  "prompt": "# Product Requirements Document\n\n*Generated from OpenSpec artifacts*\n\n## Proposal\n\n## Why\n\nWhen comparing two units, it is not immediately obvious at a glance which unit has the superior stat (e.g., higher growth rate or base stat). Highlighting the better value makes the comparison grid much easier to read and allows users to quickly identify a unit's strengths over another without having to mentally compare the numbers.\n\n## What Changes\n\n- The comparison grid cells for stats (bases, growths, averages) will be updated to visually indicate the superior value.\n- If Unit A has a higher value than Unit B for a specific stat, Unit A's cell will have a green background.\n- If Unit B has the higher value, Unit B's cell will be green.\n- If the values are equal, neither cell is highlighted.\n\n## Capabilities\n\n### New Capabilities\n- `stat-highlighting`: Adds visual highlighting to the higher of two compared stats in the comparison grid.\n- `promoted-status`: Distinguishes between base and promoted classes in the unit details view.\n\n### Modified Capabilities\n\n\n## Impact\n\n- `components/features/CombinedAverageStatsTable.tsx` and potentially other stat tables if they compare units side-by-side.\n- Utility functions may need to be added to easily compare the stats.\n- CSS/Tailwind styling for the grid cells to apply the green highlight.\n\n## Specifications\n\npromoted-status/spec.md\n## ADDED Requirements\n\n### Requirement: Promoted Status Display\nThe system SHALL visually distinguish between base classes and promoted classes when displaying a unit's level.\n\n#### Scenario: Unit is promoted\n- **WHEN** a unit is flagged as being in a promoted class (`isPromoted: true` in data)\n- **THEN** their level display under \"Unit Details\" SHALL include an indicator that they are promoted (e.g., appended text or an icon).\n\n#### Scenario: Unit is in base class\n- **WHEN** a unit is not flagged as promoted (missing or `isPromoted: false`)\n- **THEN** their level display SHALL NOT include the promoted indicator.\n\nstat-highlighting/spec.md\n## ADDED Requirements\n\n### Requirement: Stat Highlighting\nThe system SHALL visually highlight the superior stat value when comparing two units side-by-side in the comparison grid.\n\n#### Scenario: Unit A has higher stat\n- **WHEN** Unit A's calculated stat (base, growth, or average) is strictly greater than Unit B's corresponding stat\n- **THEN** Unit A's stat cell SHALL have a distinct background color (e.g., green highlight) to indicate superiority, and Unit B's cell SHALL have no highlight.\n\n#### Scenario: Unit B has higher stat\n- **WHEN** Unit B's calculated stat is strictly greater than Unit A's corresponding stat\n- **THEN** Unit B's stat cell SHALL have the distinct highlight color, and Unit A's cell SHALL have no highlight.\n\n#### Scenario: Stats are equal\n- **WHEN** Unit A's calculated stat is exactly equal to Unit B's corresponding stat\n- **THEN** neither Unit A's nor Unit B's stat cell SHALL have any highlight.\n\n#### Scenario: Missing stat for one unit\n- **WHEN** one unit is missing the stat being compared (e.g., value is undefined or N/A) while the other has a value\n- **THEN** the unit with the valid value SHALL be highlighted as superior.\n\n#### Scenario: Stat is 0 or missing for BOTH units\n- **WHEN** the stat being compared has a value of `0` or is missing (`undefined`) for **both** Unit A and Unit B\n- **THEN** the entire stat row SHALL NOT be rendered in the respective table (e.g., hiding movement growths entirely, or hiding Skill for games that use Dex).\n\n\n\n## Design\n\n## Context\n\nCurrently, the `CombinedAverageStatsTable` and related comparison grids display stats for two units side-by-side but rely on the user to visually parse and identify which stat is higher. This can be tedious for large numbers of stats. We want to add a visual highlight to the \"better\" stat in each row when comparing Unit A and Unit B to improve the UX.\n\n## Goals / Non-Goals\n\n**Goals:**\n- Visually highlight the higher stat value when comparing two units.\n- Apply highlighting to Base Stats, Growth Rates, and Average Stats tables on the comparison page.\n- Ensure the highlight is visually accessible and blends well with the existing dark mode theme.\n\n**Non-Goals:**\n- Making the highlighting color customizable by the user.\n- Highlighting stats where a literal \"lower\" value might be considered better, unless specifically required. We will assume for standard combat stats (HP, Str, Mag, Spd, etc.) that higher is better.\n\n## Decisions\n\n- **Decision 1: Utility function vs. Inline comparison**\n  - We will use an inline comparison (`valA > valB`) for most numeric stats since it is simple and effective. If specific stats ever require a \"lower is better\" logic in the future, we can refactor this into a dedicated utility function (`getBetterStat(stat, valA, valB)`).\n\n- **Decision 2: Styling method**\n  - We will use Tailwind CSS utility classes to apply the visual highlight.\n  - *Rationale:* The project is already styled with Tailwind. Applying a background color class (e.g., `bg-green-500/20` or a theme-specific success color) dynamically based on the comparison result is the most idiomatic React/Tailwind approach.\n\n- **Decision 3: Representing Promoted Status**\n  - We will add an optional `isPromoted?: boolean` field to the `Unit` interface in `types/unit.ts`.\n  - We will update the JSON data files (e.g., `data/binding_blade_units.json`) to include `\"isPromoted\": true` for prepromoted units like Marcus. If absent, it will default to `false`.\n  - In `ComparisonGrid.tsx`, the level display will check this flag. If `true`, it will append a visual indicator (e.g., \"Lv. X (Promoted)\").\n\n## Risks / Trade-offs\n\n- **Risk:** The background color might clash with the existing text colors or zebra-striping in tables.\n  - *Mitigation:* We will use a subtle, low-opacity background color (like `bg-green-500/20` or `bg-green-900/30` in dark mode) to ensure text remains highly readable.\n\n- **Risk:** Handling undefined or missing stats (e.g., older games might not have a Magic stat for physical units).\n  - *Mitigation:* The comparison logic must gracefully handle `undefined` values. If either value is missing, no highlight should be applied.\n\n## Current Task Context\n\n## Current Task\n- - [ ] 7.1 **Growth Rates Table Fix:** In `ComparisonGrid.tsx` (around line 205), change `{getCommonBaseStats(units).map((statKey) => {` to use `{getCommonGrowthStats(units).map((statKey) => {` for the Growth Rates table rendering. This will fix stats with 0% growths (like Move and Con) showing up.\n## Completed Tasks for Git Commit\n- [x] 1.1 Create inline logic or a helper function to determine the highest numeric value among a set of stat values for a given row.\n- [x] 2.1 In `ComparisonGrid.tsx`, update the Base Stats table's `<td>` cells to apply a highlight class (e.g., `bg-green-500/20`) if the unit's stat is the highest in that row.\n- [x] 2.2 Replicate this highlight logic for the Growth Rates table in `ComparisonGrid.tsx`.\n- [x] 3.1 In `ComparisonGrid.tsx`, update the Base Stats table's `<td>` cells to apply a neutral highlight class (e.g., `bg-yellow-500/20` or `bg-slate-500/20`) if the units' stats are identical and non-zero.\n- [x] 3.2 Replicate this neutral highlight logic for the Growth Rates table in `ComparisonGrid.tsx` for identical stats.\n- [x] 4.1 Update the `getCommonStats` helper function in `ComparisonGrid.tsx` to handle base stats: filter out a stat key from the visible list if *both* units have a missing (`undefined`/`null`) value for that base stat.\n- [x] 4.2 Update the same helper (or create a new one specifically for growths) to filter out a stat key from the growths table if *both* units have a missing or `0` value for that growth rate (e.g., filtering out movement growths).\n- [x] 5.1 In `ComparisonGrid.tsx`, remove the rendering of the `CombinedAverageStatsTable` component and the `showAverage` prop logic.\n- [x] 5.2 Delete the `components/features/CombinedAverageStatsTable.tsx` file entirely.\n- [x] 6.1 Update the `Unit` interface in `types/unit.ts` to include an optional boolean field `isPromoted?: boolean;`.\n- [x] 6.2 Audit data files (`binding_blade_units.json`, `engage_units.json`, `three_houses_units.json`) and add `\"isPromoted\": true` to units that start in a promoted class (e.g., Marcus).\n- [x] 6.3 In `ComparisonGrid.tsx`, under the \"Unit Details\" table, update the Level row to conditionally append `(Promoted)` if `unit.isPromoted` is true.\n",
  "promptTemplate": "openspec/changes/highlight-better-stats/.ralph/prompt-template.md",
  "startedAt": "2026-02-20T18:48:16.296Z",
  "model": "",
  "agent": "opencode"
}